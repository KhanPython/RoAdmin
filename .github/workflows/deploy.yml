name: Deploy RoAdmin Bot

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Google Cloud VM
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.REMOTE_HOST }}
          username: ${{ secrets.REMOTE_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            # === CONFIGURATION: PASTE YOUR PATHS HERE ===
            GIT_PATH="/usr/bin/git"  # Replace with output of 'which git'
            NPM_PATH="/usr/bin/npm" # Replace with output of 'which npm'
            PM2_PATH="/usr/local/bin/pm2" # Replace with output of 'which pm2'
            # ============================================

            # 1. Go to folder
            cd ~/RoAdmin

            # 2. Pull changes (using absolute git path)
            $GIT_PATH stash
            $GIT_PATH pull origin master

            # 3. Update .env
            echo 'DISCORD_TOKEN="${{ secrets.DISCORD_TOKEN }}"' > .env

            # 4. Install dependencies (using absolute npm path)
            $NPM_PATH install --production

            # 5. Restart the bot (using absolute pm2 path)
            $PM2_PATH restart RoAdmin || $PM2_PATH start src/index.js --name "RoAdmin"
            $PM2_PATH save

            echo "Deployed successfully using absolute paths."
